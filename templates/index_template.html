<!doctype html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <title>FOF 组合展示</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
  <link rel="stylesheet" href="./assets/css/fof_style.css">
  <script src="https://assets.pyecharts.org/assets/v5/echarts.min.js"></script>
</head>

<body>
  <div class="container">
    <header class="page-header">
      <h1>FOF 组合展示</h1>
      <div class="subtext">数据最新日期：{{ latest_date }}</div>
    </header>

    <section class="metrics">
      <div class="metric">
        <div class="metric-label"><strong>起始组合市值</strong></div>
        <div class="metric-value">{{ total_start | round(2) }}</div>
      </div>
      <div class="metric">
        <div class="metric-label"><strong>当前组合市值</strong></div>
        <div class="metric-value">{{ total_end | round(2) }}</div>
      </div>
      <div class="metric">
        <div class="metric-label"><strong>总收益</strong></div>
        <div class="metric-value">{{ total_return_pct | round(2) }}%</div>
      </div>
      <div class="metric">
        <div class="metric-label"><strong>年化收益</strong></div>
        <div class="metric-value">{{ annualized_return_pct | round(2) }}%</div>
      </div>
      <div class="metric">
        <div class="metric-label"><strong>最大回撤</strong></div>
        <div class="metric-value">{{ max_drawdown_pct | round(2) }}%</div>
      </div>
    </section>

    <div class="charts">
      <div class="chart-block">
        <div class="inner-card"></div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
          <h2 class="section-title">当前持仓表格</h2>
        </div>
        <div class="table-container"
          style="border:1px solid #e3e9ff;border-radius:10px;box-shadow:inset 0 1px 0 rgba(255,255,255,.6);overflow:hidden;">
          {{ table_html | safe }}
        </div>
      </div>

      <div class="chart-portfolio">
        <h2 class="section-title">组合净值及回撤</h2>
        <div id="{{ portfolio_chart_id }}" class="echarts-box-portfolio"></div>
      </div>
      <div class="chart-block chart-interval">
        <h2 class="section-title">区间收益</h2>
        <div class="table-container"
          style="border:1px solid #e3e9ff;border-radius:10px;box-shadow:inset 0 1px 0 rgba(255,255,255,.6);overflow:hidden;">
          {{ interval_table_html | safe }}
        </div>
      </div>
      <div class="chart-block chart-area">
        <h2 class="section-title">子基金配置走势图</h2>
        <div id="{{ area_chart_id }}" class="echarts-box" style="height:420px"></div>
      </div>
      <div class="row-charts">
        <div class="chart-block chart-pie">
          <h2 class="section-title">当前配置</h2>
          <div id="{{ pie_chart_id }}" class="echarts-box" style="height:360px"></div>
        </div>
        <div class="chart-block chart-corr">
          <h2 class="section-title">子基金相关性</h2>
          <div id="{{ heatmap_chart_id }}" class="echarts-box" style="height:360px"></div>
        </div>
      </div>
    </div>

    <script>
      (function () {
        const chartsOptions = {{ charts_options | safe }};
        const chartIds = {
            portfolio: "{{ portfolio_chart_id }}",
            area: "{{ area_chart_id }}",
            pie: "{{ pie_chart_id }}",
            heatmap: "{{ heatmap_chart_id }}"
        };

        for (const [key, id] of Object.entries(chartIds)) {
            const dom = document.getElementById(id);
            if (dom) {
                const chart = echarts.init(dom);
                chart.setOption(chartsOptions[key]);
                window.addEventListener('resize', () => chart.resize());
            }
        }
      })();
    </script>

    <footer class="footer" style="margin-top: 24px; color:#666; font-size:13px;">
      页面为单文件静态页面，基金详情链接模板：{{ fund_url_template }}
    </footer>
  </div>
</body>

</html>